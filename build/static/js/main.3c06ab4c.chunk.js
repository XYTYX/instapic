(this.webpackJsonpinstapic=this.webpackJsonpinstapic||[]).push([[0],{162:function(e,t,a){},220:function(e,t,a){e.exports=a(425)},225:function(e,t,a){},425:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(18),s=a.n(c),o=(a(162),a(16)),u=a.n(o),i=a(32),l=a(36),p=a(44),m=a(21),f=a(112),h=a(50),b=a(59),v=a(60),d=a(61),E=a(51),j=a(128),w=a(96),O=a(217),g=function(){function e(t){Object(E.a)(this,e),this._authToken=void 0,this._authToken=t}return Object(j.a)(e,[{key:"setAuthToken",value:function(e){this._authToken=e}},{key:"doPostFormData",value:function(){var e=Object(i.a)(u.a.mark((function e(t,a){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.doFetch(t,{method:"POST",body:a}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"doPostJson",value:function(){var e=Object(i.a)(u.a.mark((function e(t,a){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.doFetch(t,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(a)}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"doGet",value:function(){var e=Object(i.a)(u.a.mark((function e(t,a){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null===a?t:t+"?"+this.encodeQueryParams(a),e.abrupt("return",this.doFetch(n,{headers:{Authorization:this._authToken}}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"encodeQueryParams",value:function(e){return Object.keys(e).map((function(t){return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e[t]))})).join("&")}},{key:"doFetch",value:function(){var e=Object(i.a)(u.a.mark((function e(t,a){var n,r,c,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.headers,r=Object(O.a)(a,["headers"]),c=Object(w.a)({},n),this._authToken&&(c=Object(w.a)(Object(w.a)({},n),{},{Authorization:"Bearer ".concat(this._authToken)})),e.prev=3,e.next=6,fetch("/api"+t,Object(w.a)(Object(w.a)({},r),{},{headers:c}));case 6:s=e.sent,e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(3),e.t0;case 12:if(400!==s.status){e.next=16;break}throw new k;case 16:if(401!==s.status){e.next=20;break}throw new x;case 20:if(404!==s.status){e.next=24;break}throw new _;case 24:if(409!==s.status){e.next=28;break}throw new y;case 28:if(500!==s.status){e.next=30;break}throw new T;case 30:return e.abrupt("return",s);case 31:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t,a){return e.apply(this,arguments)}}()}]),e}(),k=function(e){Object(b.a)(a,e);var t=Object(v.a)(a);function a(){return Object(E.a)(this,a),t.apply(this,arguments)}return a}(Object(d.a)(Error)),y=function(e){Object(b.a)(a,e);var t=Object(v.a)(a);function a(){return Object(E.a)(this,a),t.apply(this,arguments)}return a}(Object(d.a)(Error)),x=function(e){Object(b.a)(a,e);var t=Object(v.a)(a);function a(){return Object(E.a)(this,a),t.apply(this,arguments)}return a}(Object(d.a)(Error)),_=function(e){Object(b.a)(a,e);var t=Object(v.a)(a);function a(){return Object(E.a)(this,a),t.apply(this,arguments)}return a}(Object(d.a)(Error)),T=function(e){Object(b.a)(a,e);var t=Object(v.a)(a);function a(){return Object(E.a)(this,a),t.apply(this,arguments)}return a}(Object(d.a)(Error)),S=function(){function e(t){Object(E.a)(this,e),this._client=void 0,this._client=t}return Object(j.a)(e,[{key:"setClient",value:function(e){this._client=e}},{key:"getAllUsers",value:function(){var e=Object(i.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/v1/user",e.prev=1,e.next=4,this._client.doGet("/v1/user",null);case 4:t=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0;case 10:return e.abrupt("return",t.json());case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"getPostsByUser",value:function(){var e=Object(i.a)(u.a.mark((function e(t){var a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="/v1/post/".concat(t),e.prev=1,e.next=4,this._client.doGet(a,null);case 4:n=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0;case 10:return e.abrupt("return",n.json());case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getUser",value:function(){var e=Object(i.a)(u.a.mark((function e(t){var a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="/v1/user/".concat(t),e.prev=1,e.next=4,this._client.doGet(a,null);case 4:n=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0;case 10:return e.abrupt("return",n.json());case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(i.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/v1/auth/logout",e.prev=1,e.next=4,this._client.doPostJson("/v1/auth/logout",{});case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),e.t0;case 9:return e.abrupt("return");case 10:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"newPost",value:function(){var e=Object(i.a)(u.a.mark((function e(t,a){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/v1/post",(r=new FormData).append("file",t),r.append("text",a),e.prev=4,e.next=7,this._client.doPostFormData("/v1/post",r);case 7:n=e.sent,e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(4),e.t0;case 13:return e.abrupt("return",n.json());case 14:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=Object(i.a)(u.a.mark((function e(t,a){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/v1/auth/login",e.prev=1,e.next=4,this._client.doPostJson("/v1/auth/login",{email:t,password:a});case 4:return n=e.sent,e.abrupt("return",n.json());case 8:if(e.prev=8,e.t0=e.catch(1),!(e.t0 instanceof x)){e.next=12;break}throw new P;case 12:if(!(e.t0 instanceof T)){e.next=16;break}throw new N;case 16:throw e.t0;case 17:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"signup",value:function(){var e=Object(i.a)(u.a.mark((function e(t,a,n){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/v1/user",e.prev=1,e.next=4,this._client.doPostJson("/v1/user",{email:t,username:a,password:n});case 4:return r=e.sent,e.abrupt("return",r.json());case 8:if(e.prev=8,e.t0=e.catch(1),!(e.t0 instanceof y)){e.next=14;break}throw new C;case 14:throw e.t0;case 15:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"getPosts",value:function(){var e=Object(i.a)(u.a.mark((function e(t,a,n){var r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={sort_by:t},null!==n&&null!==a&&(c={sort_by:t,offset:String(a),limit:String(n)}),e.prev=2,e.next=5,this._client.doGet("/v1/post",c);case 5:return r=e.sent,e.abrupt("return",r.json());case 9:throw e.prev=9,e.t0=e.catch(2),e.t0;case 12:case"end":return e.stop()}}),e,this,[[2,9]])})));return function(t,a,n){return e.apply(this,arguments)}}()}]),e}(),P=function(e){Object(b.a)(a,e);var t=Object(v.a)(a);function a(){return Object(E.a)(this,a),t.apply(this,arguments)}return a}(Object(d.a)(Error)),N=function(e){Object(b.a)(a,e);var t=Object(v.a)(a);function a(){return Object(E.a)(this,a),t.apply(this,arguments)}return a}(Object(d.a)(Error)),C=function(e){Object(b.a)(a,e);var t=Object(v.a)(a);function a(){return Object(E.a)(this,a),t.apply(this,arguments)}return a}(Object(d.a)(Error)),B=a(438),F=(a(225),a(441)),R=a(440),U=a(433),M=a(434),q=a(77),A=a.n(q),D=a(58),I=a.n(D),J=a(199),L=a.n(J);function z(e){var t=Object(n.useState)([]),a=Object(l.a)(t,2),c=a[0],s=a[1],o=Object(n.useState)(!1),p=Object(l.a)(o,2),m=p[0],f=p[1],b=Object(q.useForm)(),v=Object(l.a)(b,1)[0];return r.a.createElement(U.a,{title:"New Post",visible:e.visible,onCancel:e.hideModal,okText:"Submit",okButtonProps:{disabled:0===c.length},onOk:function(){v.validateFields().then(function(){var t=Object(i.a)(u.a.mark((function t(a){var n,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.file,r=a.text,f(!0),t.prev=3,t.next=6,e.api.newPost(n.file.originFileObj,r||"");case 6:t.next=10;break;case 8:t.prev=8,t.t0=t.catch(3);case 10:return f(!1),e.hideModal(),t.prev=12,t.next=15,e.getPosts(ae.MOST_RECENT,0,10);case 15:t.next=19;break;case 17:t.prev=17,t.t1=t.catch(12);case 19:case"end":return t.stop()}}),t,null,[[3,8],[12,17]])})));return function(e){return t.apply(this,arguments)}}())},confirmLoading:m,destroyOnClose:!0},r.a.createElement(A.a,{form:v,preserve:!1,name:"validate_other"},r.a.createElement(I.a,{name:"file",label:"Image",extra:"Please upload a .png, .jpg, .jpeg, or .gif image"},r.a.createElement(L.a,{customRequest:function(e){var t=e.onSuccess;setTimeout((function(){t("ok")}),0)},onChange:function(e){var t=[];switch(e.file.status){case"uploading":case"done":t=[e.file];break;default:t=[]}s(t)},fileList:c,name:"logo",listType:"picture",beforeUpload:function(e){return!!["image/png","image/jpg","image/jpeg","image/gif"].includes(e.type)||(R.b.error("".concat(e.name," is not in a file format that we support")),!1)}},r.a.createElement(h.a,{icon:r.a.createElement(F.a,null)},"Click to upload"))),r.a.createElement(I.a,{name:"text",label:"Subtitle"},r.a.createElement(M.a,{required:!0}))))}var G=a(442),Y=a(432),Q=a(439),W=a(431),$=a(430),H=a(435),K=a(206),V=a.n(K),X=a(437);function Z(e){return r.a.createElement("div",{className:"feed"},e.posts.map((function(e){return r.a.createElement($.a,{className:"card",key:Object(X.a)()},r.a.createElement(H.a,{className:"image",src:e.images[0].full_src,alt:"image"}),r.a.createElement(V.a,{style:{marginTop:"16px"},title:void 0!==e.text?e.text:""}))})))}function ee(e){var t=Object(n.useState)(ae.MOST_RECENT),a=Object(l.a)(t,2),c=a[0],s=a[1],o=Object(n.useState)(0),u=Object(l.a)(o,2),i=u[0],p=u[1],m=Object(n.useState)(3),f=Object(l.a)(m,2),b=f[0],v=f[1];return Object(n.useEffect)((function(){e.getPosts(c,null,null)}),[c]),r.a.createElement("div",{className:"spaced"},r.a.createElement("h2",{style:{marginBottom:0}},"Explore"),function(t){if(null!==t&&0!==t.length){var a=r.a.createElement(Y.a,{onClick:function(e){e.key===ae.MOST_RECENT?s(ae.MOST_RECENT):s(ae.BY_USERS)}},r.a.createElement(Y.a.Item,{key:ae.MOST_RECENT},"Most Recent"),r.a.createElement(Y.a.Item,{key:ae.BY_USERS},"By User"));return r.a.createElement(r.a.Fragment,null,r.a.createElement(Q.a,{overlay:a,trigger:["click"]},r.a.createElement(h.a,{type:"text"},"Sort By ",r.a.createElement(G.a,null))),c===ae.MOST_RECENT?r.a.createElement(r.a.Fragment,null,r.a.createElement(Z,{posts:t.slice(i,i+b)}),r.a.createElement(W.a,{style:{marginTop:"12px",marginBottom:"12px"},onChange:function(e,t){var a=t||3;p((e-1)*a),v(a)},defaultCurrent:1,total:t.length,pageSize:b})):r.a.createElement(te,{api:e.api,posts:t}))}}(e.posts))}function te(e){var t=Object(n.useState)([]),a=Object(l.a)(t,2),c=a[0],s=a[1];Object(n.useEffect)((function(){Object(i.a)(u.a.mark((function t(){var a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.api.getAllUsers();case 2:a=t.sent,s(a);case 4:case"end":return t.stop()}}),t)})))()}),[e.api,e.posts]);var o=e.posts.sort((function(e,t){var a=e.created_on.split(/[- :]/).map((function(e){return Number(e)})),n=t.created_on.split(/[- :]/).map((function(e){return Number(e)})),r=new Date(Date.UTC(a[0],a[1]-1,a[2],a[3],a[4],a[5])),c=new Date(Date.UTC(n[0],n[1]-1,n[2],n[3],n[4],n[5]));return r<c?1:-1}));return r.a.createElement("div",{className:"rowFeed"},c.map((function(e,t){var a,n,c=o.filter((function(t){return t.user_public_id===e.public_id})),s=null===(a=c[0])||void 0===a||null===(n=a.images[0])||void 0===n?void 0:n.full_src;return r.a.createElement($.a,{className:"rowCard",key:t},r.a.createElement(H.a,{className:"image",src:s||"http://i2.wp.com/juju.com.hk/wp-content/uploads/2019/11/placeholder.png",alt:"image"}),r.a.createElement(se,{username:e.username,index:0,posts:c}))})))}var ae,ne=a(443),re=a(125),ce=a.n(re);function se(e){var t=Object(n.useState)(!1),a=Object(l.a)(t,2),c=a[0],s=a[1];function o(){s(!1)}return r.a.createElement(r.a.Fragment,null,r.a.createElement(h.a,{style:{marginTop:"10px"},type:"link",onClick:function(){s(!0)}},e.username,r.a.createElement(ne.a,null)),r.a.createElement(ce.a,{footer:r.a.createElement(h.a,{type:"primary",onClick:o},"Close"),visible:c,onOk:o,onCancel:o},0!==e.posts.length?r.a.createElement(Z,{posts:e.posts}):r.a.createElement("div",null,"This user hasn't uploaded any photos yet!")))}function oe(e){function t(){return(t=Object(i.a)(u.a.mark((function t(a){var n,r,c,s,o,i;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.email,r=a.password,t.prev=1,t.next=4,e.api.login(n,r);case 4:c=t.sent,s=new B.a,o=new Date,(i=new Date).setMinutes(o.getMinutes()+15),s.set("instapic_jwt",c.authorization,{expires:i}),e.setAuthToken(c.authorization),t.next=24;break;case 13:if(t.prev=13,t.t0=t.catch(1),!(t.t0 instanceof P)){t.next=19;break}R.b.error("Login unsuccessful, check your email and password. Did you mean to sign up?"),t.next=24;break;case 19:if(!(t.t0 instanceof N)){t.next=23;break}R.b.error("Our systems seem to be experiencing issues, please try again later"),t.next=24;break;case 23:throw t.t0;case 24:case"end":return t.stop()}}),t,null,[[1,13]])})))).apply(this,arguments)}return r.a.createElement("div",{className:"authForm"},r.a.createElement("h2",{className:"spaced"},"Log In"),r.a.createElement(A.a,{onFinish:function(e){return t.apply(this,arguments)}},r.a.createElement(I.a,{required:!0,label:"Email",name:"email",rules:[{required:!0,message:"Please enter an email"},{type:"email"}]},r.a.createElement(M.a,null)),r.a.createElement(I.a,{required:!0,label:"Password",name:"password",rules:[{required:!0,message:"Please enter a password"}]},r.a.createElement(M.a.Password,null)),r.a.createElement("button",null,"Log In")))}function ue(e){function t(){return(t=Object(i.a)(u.a.mark((function t(a){var n,r,c,s,o;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.email,r=a.username,c=a.password,t.prev=1,t.next=4,e.api.signup(n,r,c);case 4:s=t.sent,e.setAuthToken(null===(o=s)||void 0===o?void 0:o.authorization),t.next=15;break;case 8:if(t.prev=8,t.t0=t.catch(1),!(t.t0 instanceof C)){t.next=14;break}R.b.error("That email or username already exists, did you mean to log in?"),t.next=15;break;case 14:throw t.t0;case 15:case"end":return t.stop()}}),t,null,[[1,8]])})))).apply(this,arguments)}return r.a.createElement("div",{className:"authForm"},r.a.createElement("h2",{className:"spaced"},"Sign Up"),r.a.createElement(A.a,{onFinish:function(e){return t.apply(this,arguments)}},r.a.createElement(I.a,{required:!0,label:"Email",name:"email",rules:[{required:!0,message:"Please enter an email"},{type:"email"}]},r.a.createElement(M.a,null)),r.a.createElement(I.a,{required:!0,label:"Username",name:"username",rules:[{required:!0,message:"Please enter a username"}]},r.a.createElement(M.a,null)),r.a.createElement(I.a,{required:!0,label:"Password",name:"password",rules:[{required:!0,message:"Please enter a password"},{min:8,message:"Make sure your password is at least 8 characters in length"}]},r.a.createElement(M.a.Password,null)),r.a.createElement("button",null,"Sign Up")))}function ie(){var e=Object(p.a)();return r.a.createElement("div",{className:"App"},r.a.createElement(m.c,{history:e},r.a.createElement(le,null)))}function le(){var e=Object(n.useState)([]),t=Object(l.a)(e,2),a=t[0],c=t[1],s=new B.a,o=s.get("instapic_jwt"),p=Object(n.useState)(o||""),b=Object(l.a)(p,2),v=b[0],d=b[1],E=Object(n.useRef)(new g(v)),j=Object(n.useRef)(new S(E.current)),w=Object(n.useState)(!1),O=Object(l.a)(w,2),k=O[0],y=O[1];function x(e,t,a){return _.apply(this,arguments)}function _(){return(_=Object(i.a)(u.a.mark((function e(t,a,n){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.current.getPosts(t,a,n);case 2:r=e.sent,c(r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(){return(T=Object(i.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.current.logout();case 2:s.remove("instapic_jwt"),d("");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)((function(){E.current.setAuthToken(v),j.current.setClient(E.current)}),[v]),r.a.createElement("div",{className:"App"},r.a.createElement("p",{className:"spaced"}),r.a.createElement("nav",null,!v&&r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,{className:"topBarButton",to:"/login"},r.a.createElement(h.a,null,"Log In")),r.a.createElement(f.a,{className:"topBarButton",to:"/signup"},r.a.createElement(h.a,null,"Signup"))),v&&r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,{className:"topBarButton",to:"/explore"},r.a.createElement(h.a,null,"Explore")),r.a.createElement(f.a,{className:"topBarButton",to:"new_post"},r.a.createElement(h.a,{onClick:function(){y(!0)}},"New Post"),r.a.createElement(z,{getPosts:x,hideModal:function(){y(!1)},visible:k,api:j.current})),r.a.createElement(h.a,{className:"topBarButton",onClick:function(){return T.apply(this,arguments)}},"Log Out"))),r.a.createElement(m.d,null,r.a.createElement(m.b,{path:"/login"},v?r.a.createElement(m.a,{to:"/"}):r.a.createElement(oe,{api:j.current,setAuthToken:d})),r.a.createElement(m.b,{path:"/signup"},v?r.a.createElement(m.a,{to:"/"}):r.a.createElement(ue,{api:j.current,setAuthToken:d})),r.a.createElement(m.b,{path:"/explore"},v?r.a.createElement(ee,{posts:a,getPosts:x,api:j.current}):r.a.createElement(m.a,{to:"login"})),r.a.createElement(m.b,{path:"/"},v?r.a.createElement(ee,{posts:a,getPosts:x,api:j.current}):r.a.createElement(m.a,{to:"login"}))))}!function(e){e.MOST_RECENT="most_recent",e.BY_USERS="by_users"}(ae||(ae={}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(ie,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[220,1,2]]]);
//# sourceMappingURL=main.3c06ab4c.chunk.js.map